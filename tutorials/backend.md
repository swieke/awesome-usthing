# Intro to Backend Dev in USThing

Welcome aboard! In this doc we will walk through flows and common practices for backend development and operations.

# Development

## Language and Coding Style

We are now using NodeJS with Express framework to develop new backend services, while older codes are in PHP. You are recommended to use NodeJS for new projects but other ecosystems e.g. Python, Swift can be considered as well. Consult with Lead Dev for further discussion.

One of our projectâ€™s goals is to provide opportunities for you to experiment with latest technologies, therefore, we encourage you to use newer standards i.e. ES6 or newer. Below are some guidelines to embrace newer features:

- use arrow functions `(arg) => {block}`
- use promises instead of completion blocks
- use async-await instead of `promise.then().catch()`
- use `.map()` or `.forEach()` instead of looping with iterator
- use `(condition) ? (true block) : (false block)` instead of if-then-else block for simple value returning

Also, we are following Standard JS (https://standardjs.com/) as our style guide. Visit their website for linters and guides.

## Content Type, Response and API Design

We usually return JSON for our clients. Field names are usually in snake_case with exception of resource names that will be used in URLs, where lisp-case should be used.

For client requests, JSON is usually used as it's easier to contain complex data structure but www forms can be considered as well.

When designing your API, RESTful standards should be kept in mind (to reduce the need of intensive documentation and improve UX). This (https://stackoverflow.com/questions/671118/what-exactly-is-restful-programming) post should give you a brief summary on what RESTful is.

In the response, you should give a `success` boolean flag to indicate whether the request is processed correctly and `error` message should be returned to explain the failure. Suitable HTTP Status Code should be returned as well, this (http://www.restapitutorial.com/httpstatuscodes.html) can be used as reference.

When handling with time values, always use ISO8601 (link:) as format and prefer UTC as default timezone. This is to standardize time formats for easy parsing and reduce timezone confusion. 

## Client Authentication

We use header verification to protect our services from unknown clients. All mobile clients will include the token generated by our custom algorithm in `User-Agent` . For testing in Postman or other clients, `X-USThing` can be used as well. Contact our Lead Dev for the token generator script if needed.

## Internal APIs

APIs are available for common actions such as ITSC Account authentication, 2FA handling and client token verification.

- LoginCAS (https://github.com/chihimng/usthing-logincas-api-nodejs)
- 2FA API (https://github.com/chihimng/usthing-2fa-api)
- ~Token Verification Helper~ This should be handled by our custom clipped preset (https://github.com/inizio/clipped-preset-usthing-nodejs), but this is the middleware fyi (https://github.com/inizio/usthing-gateway)

# Operations

## Infrastructure

Our backend service is currently hosted on a Ubuntu virtual machine provided by ITSC, which is inside the campus network. All services are hosted on Docker.

## Services

- Nginx + Docker-gen + Let's Encrypt Helper
- MySQL
- MongoDB
- Redis

## Main Repos

Our backend codes are contained by the following repos either directly or via submodule

- USThing_Server_Docker (https://github.com/chihimng/USThing_Server_Docker)
- USThing_Server (https://github.com/tszkanlo/USThing_Server) (Deprecated)
- USThing_Server_NodeJS (https://github.com/chihimng/usthing_server_nodejs) (Legacy)

## Virtual Hosts and File Directories

- Refer to Docker Repo

## Deployment

- Refer to Docker Repo
